pipeline {
    agent { docker { image 'node:14.19.' } }
    stages {
        stage('test_unit') {
            steps {
                sh 'make tests'
            }
        }
        stage('build') {
            steps {
                // this assumes that the Jenkins runner has been configured to allow Docker commands as in
                // https://blog.container-solutions.com/running-docker-in-jenkins-in-docker#:~:text=Open%20the%20Jenkins%20home%20page,sudo%20docker%20run%20hello%2Dworld%22
                sh 'make build'
            }
        }
        stage('deploy_staging') {
            steps {
                sh 'node --version'
            }
        }
        stage('test_integration') {
            steps {
                sh 'node --version'
            }
        }
        stage('deploy_prod') {
            steps {
                sh 'node --version'
            }
        }
    }
}
